/**
 * Gradle build script for CSIRO CASDA SODALint library.
 * Built for Gradle v2.7
 * 
 */

plugins {
  id "com.github.spotbugs" version "1.6.9"
}

// Apply the java plugin to add support for Java
apply plugin: 'java'
apply plugin: 'maven-publish'

group = 'au.csiro.casda'

description = """SODA Validation Library"""

ext {
    majorVersion = 1
    minorVersion = 0
}

// In this section you declare where to find the dependencies of your project
repositories {
    mavenLocal()
    jcenter()
    ivy {
        url 'https://github.com/csiro-rds/sodalint/raw/master/'
        layout ('pattern') {
            artifact 'external-libs/[artifact]-[revision](-[classifier])(.[ext])'
        }
    }
    maven { url 'http://jenkins-cdc.it.csiro.au:8085/nexus/content/repositories/thirdparty' }
}

// In this section you declare the dependencies for your production and test code
dependencies {
	compile("uk.ac.starlink:task:3.0.9")
	compile("uk.ac.starlink:ttools:3.0.9")
	compile("uk.ac.starlink:vo:3.0.9")
	compile("uk.ac.starlink:votable:3.0.9")
	
    compile('org.apache.httpcomponents:httpclient:4.5.2') 
    compile('org.apache.httpcomponents:fluent-hc:4.5.2') 
     // For things like RandomStringUtils, StringUtils
    compile("org.apache.commons:commons-lang3:3.4")
    //compile("org.apache.ws.commons:ws-commons-util:1.0.1")

    // Declare the dependency for your favourite test framework you want to use in your tests.
    // TestNG is also supported by the Gradle Test task. Just change the
    // testCompile dependency to testCompile 'org.testng:testng:6.8.1' and add
    // 'test.useTestNG()' to your build script.
    testCompile 'junit:junit:4.12'
    // For things like FilenameUtils
    testCompile('commons-io:commons-io:2.4')

    runtime('uk.ac.starlink:table:3.0.9')
    runtime('uk.ac.starlink:util:3.0.9')
}


apply from: 'gradle/versioning.gradle'

jar {
    manifest {
        attributes 'Implementation-Title': 'SODALint', 'Implementation-Version': project.version, 
            'Built-On': buildTimestamp,
        	'Main-Class': 'au.csiro.casda.sodalint.SodaLinter' 
    }
}

//create a single Jar with all dependencies
task allJar(type: Jar) {
	manifest {
        attributes 'Implementation-Title': 'SODALint',  
        	'Implementation-Version': version, 
            'Built-On': buildTimestamp,
        	'Main-Class': 'au.csiro.casda.sodalint.SodaLinter'
    }
    baseName = project.name + '-all'
    from { configurations.runtime.collect { it.isDirectory() ? it : zipTree(it) } }
    with jar
}


task sourceJar(type: Jar) {
    from sourceSets.main.java
    classifier "sources"
    manifest {
        attributes 'Implementation-Title': 'SODALint', 'Implementation-Version': project.version, 
            'Built-On': buildTimestamp 
    }
}

task javadocJar(type: Jar, dependsOn: javadoc) {
    classifier = 'javadoc'
    from javadoc.destinationDir
    manifest {
        attributes 'Implementation-Title': 'SODALint', 'Implementation-Version': project.version, 
            'Built-On': buildTimestamp 
    }
}

//=====================================================================================================================
//
// Include other build files
//
//=====================================================================================================================

// Produces pmd, findbugs and checkstyle reports.
apply from: 'gradle/report.gradle'

// Produces jacoco code coverage report.
apply from: 'gradle/coverage-report.gradle'

// We conditionally apply the publish script so that we don't need the properties for all builds.
if (gradle.startParameter.taskNames.any{it =~ /publish/}) {
    apply from: 'gradle/publish.gradle'
    publishing {
        publications {
            mavenJava(MavenPublication) {
                artifactId 'sodalint'
                from components.java
                artifact(sourceJar) {
                    classifier "sources"
                }
                artifact(javadocJar) {
                    classifier "javadoc"
                }
            }
        }
    }
    
}
